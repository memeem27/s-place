<!DOCTYPE html>
<!-- Created with https://packager.turbowarp.org/ -->
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- We only include this to explicitly loosen the CSP of various packager environments. It does not provide any security. -->
  <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob:">
  <title>s_place</title>
  <style>
    body {
      color: #ffffff;
      font-family: sans-serif;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    :root, body.is-fullscreen {
      background-color: #000000;
    }
    [hidden] {
      display: none !important;
    }
    h1 {
      font-weight: normal;
    }
    a {
      color: inherit;
      text-decoration: underline;
      cursor: pointer;
    }

    #app, #loading, #error, #launch {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: default;
      user-select: none;
      -webkit-user-select: none;
      background-color: #000000;
    }
    #launch {
      background-color: rgba(0, 0, 0, 0.7);
      cursor: pointer;
    }
    .green-flag {
      width: 80px;
      height: 80px;
      padding: 16px;
      border-radius: 100%;
      background: rgba(255, 255, 255, 0.75);
      border: 3px solid hsla(0, 100%, 100%, 1);
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }
    #loading {
      
    }
    .progress-bar-outer {
      border: 1px solid currentColor;
      height: 10px;
      width: 200px;
      max-width: 200px;
    }
    .progress-bar-inner {
      height: 100%;
      width: 0;
      background-color: currentColor;
    }
    .loading-text, noscript {
      font-weight: normal;
      font-size: 36px;
      margin: 0 0 16px;
    }
    .loading-image {
      margin: 0 0 16px;
    }
    #error-message, #error-stack {
      font-family: monospace;
      max-width: 600px;
      white-space: pre-wrap;
      user-select: text;
      -webkit-user-select: text;
    }
    #error-stack {
      text-align: left;
      max-height: 200px;
      overflow: auto;
    }
    .control-button {
      width: 2rem;
      height: 2rem;
      padding: 0.375rem;
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
      user-select: none;
      -webkit-user-select: none;
      cursor: pointer;
      border: 0;
      border-radius: 4px;
    }
    .control-button-highlight:hover {
      background: #ff8c1a26;
    }
    .control-button-highlight.active {
      background: #ff8c1a59;
    }
    .fullscreen-button {
      background: white;
    }
    .standalone-fullscreen-button {
      position: absolute;
      top: 0;
      right: 0;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 0 0 0 4px;
      padding: 4px;
      cursor: pointer;
    }
    .sc-canvas {
      cursor: auto;
    }
    .sc-monitor-root[data-opcode^="data_"] .sc-monitor-value-color {
      background-color: #ff8c1a;
    }
    .sc-monitor-row-value-outer {
      background-color: #fc662c;
    }
    .sc-monitor-row-value-editing .sc-monitor-row-value-outer {
      background-color: #e25b27;
    }
    
  </style>
  <meta name="theme-color" content="#000000">
  
</head>
<body>
  <div id="app"></div>

  <div id="launch" class="screen" hidden title="Click to start">
    <div class="green-flag">
      <svg viewBox="0 0 16.63 17.5" width="42" height="44">
        <defs><style>.cls-1,.cls-2{fill:#4cbf56;stroke:#45993d;stroke-linecap:round;stroke-linejoin:round;}.cls-2{stroke-width:1.5px;}</style></defs>
        <path class="cls-1" d="M.75,2A6.44,6.44,0,0,1,8.44,2h0a6.44,6.44,0,0,0,7.69,0V12.4a6.44,6.44,0,0,1-7.69,0h0a6.44,6.44,0,0,0-7.69,0"/>
        <line class="cls-2" x1="0.75" y1="16.75" x2="0.75" y2="0.75"/>
      </svg>
    </div>
  </div>

  <div id="loading" class="screen">
    <noscript>Enable JavaScript</noscript>
    
    
    <div class="progress-bar-outer"><div class="progress-bar-inner" id="loading-inner"></div></div>
  </div>

  <div id="error" class="screen" hidden>
    <h1>Error</h1>
    <details>
      <summary id="error-message"></summary>
      <p id="error-stack"></p>
    </details>
  </div>

  <script src="script.js"></script>
  <script>
    const appElement = document.getElementById('app');
    const launchScreen = document.getElementById('launch');
    const loadingScreen = document.getElementById('loading');
    const loadingInner = document.getElementById('loading-inner');
    const errorScreen = document.getElementById('error');
    const errorScreenMessage = document.getElementById('error-message');
    const errorScreenStack = document.getElementById('error-stack');

    const handleError = (error) => {
      console.error(error);
      if (!errorScreen.hidden) return;
      errorScreen.hidden = false;
      errorScreenMessage.textContent = '' + error;
      let debug = error && error.stack || 'no stack';
      debug += '\nUser agent: ' + navigator.userAgent;
      errorScreenStack.textContent = debug;
    };
    const setProgress = (progress) => {
      if (loadingInner) loadingInner.style.width = progress * 100 + '%';
    };
    const interpolate = (a, b, t) => a + t * (b - a);

    try {
      setProgress(0.1);

      const scaffolding = new Scaffolding.Scaffolding();
      scaffolding.width = 480;
      scaffolding.height = 360;
      scaffolding.resizeMode = "preserve-ratio";
      scaffolding.editableLists = false;
      scaffolding.usePackagedRuntime = true;
      scaffolding.setup();
      scaffolding.appendTo(appElement);

      const vm = scaffolding.vm;
      window.scaffolding = scaffolding;
      window.vm = scaffolding.vm;
      window.Scratch = {
        vm,
        renderer: vm.renderer,
        audioEngine: vm.runtime.audioEngine,
        bitmapAdapter: vm.runtime.v2BitmapAdapter,
        videoProvider: vm.runtime.ioDevices.video.provider
      };

      scaffolding.setUsername("player####".replace(/#/g, () => Math.floor(Math.random() * 10)));
      scaffolding.setAccentColor("#ff8c1a");

      // TURBOWARP CLOUD PROVIDER REMOVED - NOW USING FIREBASE
      // The Firebase cloud system will handle cloud variables instead

      vm.setTurboMode(false);
      if (vm.setInterpolation) vm.setInterpolation(false);
      if (vm.setFramerate) vm.setFramerate(30);
      if (vm.renderer.setUseHighQualityRender) vm.renderer.setUseHighQualityRender(true);
      if (vm.setRuntimeOptions) vm.setRuntimeOptions({
        fencing: true,
        miscLimits: true,
        maxClones: 300,
      });
      if (vm.setCompilerOptions) vm.setCompilerOptions({
        enabled: true,
        warpTimer: false
      });
      if (vm.renderer.setMaxTextureDimension) vm.renderer.setMaxTextureDimension(2048);

      // enforcePrivacy threat model only makes sense in the editor
      if (vm.runtime.setEnforcePrivacy) vm.runtime.setEnforcePrivacy(false);

      if (typeof ScaffoldingAddons !== 'undefined') {
        ScaffoldingAddons.run(scaffolding, {"gamepad":false,"pointerlock":false,"specialCloudBehaviors":false,"unsafeCloudBehaviors":false,"pause":false});
      }

      scaffolding.setExtensionSecurityManager({
        getSandboxMode: () => 'unsandboxed',
        canLoadExtensionFromProject: () => true
      });
      for (const extension of ["data:text/javascript;base64,Ly8gQ3JlYXRlZCBieSBEYXdpZCBFbmRlcm1hbg0KDQooZnVuY3Rpb24oU2NyYXRjaCkgew0KICAgICd1c2Ugc3RyaWN0JzsNCg0KICAgIGNsYXNzIFR1cmJvYmFzZUV4dGVuc2lvbiB7DQogICAgICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAgICAgdGhpcy5hcGlVcmwgPSAnJzsgDQogICAgICAgICAgICB0aGlzLmFwaUtleSA9ICcnOyANCiAgICAgICAgfQ0KDQogICAgICAgIGdldEluZm8oKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGlkOiAnZGF3aWRlbmRlcm1hbnR1cmJvYmFzZScsDQogICAgICAgICAgICAgICAgbmFtZTogJ1R1cmJvYmFzZScsDQogICAgICAgICAgICAgICAgY29sb3IxOiAnI0ZGNTcyMicsIA0KICAgICAgICAgICAgICAgIGNvbG9yMjogJyNGRjU3MjInLCANCiAgICAgICAgICAgICAgICBjb2xvcjM6ICcjRkY1NzIyJywgDQogICAgICAgICAgICAgICAgYmxvY2tzOiBbDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogJ3NldEFwaVVybCcsDQogICAgICAgICAgICAgICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnc2V0IEZpcmViYXNlIFVSTCB0byBbVVJMXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVUkw6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICdzZXRBcGlLZXknLA0KICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ3NldCBGaXJlYmFzZSBBUEkgS2V5IHRvIFtBUElfS0VZXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBUElfS0VZOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAnZmV0Y2hEYXRhJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnZmV0Y2ggZGF0YSBmcm9tIFtQQVRIXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVRIOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAnd3JpdGVEYXRhJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICd3cml0ZSBbVkFMVUVdIHRvIFtQQVRIXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWQUxVRTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBVEg6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcGNvZGU6ICdkZWxldGVEYXRhJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdkZWxldGUgZGF0YSBmcm9tIFtQQVRIXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVRIOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAncmVnaXN0ZXJVc2VyJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdyZWdpc3RlciB1c2VyIHdpdGggZW1haWwgW0VNQUlMXSBhbmQgcGFzc3dvcmQgW1BBU1NXT1JEXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTUFJTDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBU1NXT1JEOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3Bjb2RlOiAnbG9naW5Vc2VyJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnbG9naW4gdXNlciB3aXRoIGVtYWlsIFtFTUFJTF0gYW5kIHBhc3N3b3JkIFtQQVNTV09SRF0nLA0KICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRU1BSUw6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogU2NyYXRjaC5Bcmd1bWVudFR5cGUuU1RSSU5HLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICcnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVNTV09SRDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogJ3NlbmRQYXNzd29yZFJlc2V0RW1haWwnLA0KICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ3NlbmQgcGFzc3dvcmQgcmVzZXQgZW1haWwgdG8gW0VNQUlMXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTUFJTDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wY29kZTogJ2dldEVtYWlsVUlEJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsDQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnZ2V0IFVJRCBvZiB1c2VyIHdpdGggZW1haWwgW0VNQUlMXSBhbmQgcGFzc3dvcmQgW1BBU1NXT1JEXScsDQogICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTUFJTDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBU1NXT1JEOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAnJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0sDQoJCQkJbWVudUljb25VUkk6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUdRQUFBQmtDQVlBQUFCdzRwVlVBQUFCYm1sRFExQnBZMk1BQUNpUmRaRTdTd05CRklVL294THhnWVVXSW9JcG9sZ2tFQlRFVWlLWUpsckVDRVp0c3VzbUVaSzQ3RzZRWUN2WVdBUXNSQnRmaGY5QVc4RldRUkFVUWNUUzJsY2pzdDVKQWdtU3pESjdQODdNdWN5Y0FVODBxK2ZzdGhEazhvNFZpNFI5UzRsbG4vY05MOFAwRUNDVTFHMXpibUUyVHRQeC9VQ0xxdmRCMWF2NXZvYWphODJ3ZFdqcEVKN1VUY3NSbmhhT2JqcW00bDNoZmoyVFhCTStGZzVZY2tEaEc2VnJGWDVWbks3d3AySXJIcHNCaitycFM5ZXhWc2Q2eHNvSmp3bjdjOW1DWGoyUHVrbTNrVjlja0Rvb2N3aWJHQkhDK05Bb3NFNFdoNkRVdkdUVzJCY3ErK2JaRUk4dWY1TWlsampTWk1RYkVMVWdYUTJwS2RFTitiSVVWZTcvODdSVEUrT1Y3dDFoYUg5eDNZOFI4TzdCYjhsMWYwNWM5L2NVV3AvaEtsL3piMGhPVTEraWwycWEvd2g2dCtIaXVxWnArM0M1QXdOUFp0SktscVZXbVo1VUN0N1BvU2NCZlhmUXVWTEpxcnJPMlNQRXQrU0pidUhnRUVabGYrL3FIMk4yYURqL0tNaDlBQUFBQ1hCSVdYTUFBQzRqQUFBdUl3RjRwVDkyQUFBU04wbEVRVlI0WHVWZEI1UmNWUmwrZmNwTzN6TGJTN2FsQjVLWUVKYVNRSTdFb0lnbVJnUThZRHhSQ1NqRnFFZU9KeWdvSWdpb2dCekJJQnlKVWVBUWlKQWdSV0lRUWhLQkxKR1VUZDhBU2JiTmx0bHByL24vTXpzNkxMczdyODY4d1h2eXNzbk92ZmY5OS8vdVgrLy8zaERFSjdBdGJ5aTlucXFhWlA4RUxxM3dsclJoc3YzN2IwMW5lbjdiV25SWjRWSC9TYUs0ZUJZTFlEeHdjRG9wbjV4SnlMdW0wYUVmTjN2bkZkb1M2VUlqZUN4NnkydHIyYi80ano4MGwwdXNJbVdaU01nRTRhZGtlekVsTGlROC9pM3ZoS0o5aGJMT2dnZkVWOVhBL3RuejRZUFRXSDZsS01tRU5NSjVBWDZXMGxKeEtTV2UwZThxZnJxamZ6aGVDS0FVTmlEQnlmUW0vL0VIV21sK2xRQlNBWDgrMGtUNFJRVXQxdFZRdlA5UDR0d1hpZGdIYWJ3c2kwM2hBdUk1aTM0MnVPLyttUXovemJIQVNITWNOQmhSVEV0ejV6aDZvOC8wQ1ArMExCSWpoQlVvSURMeFVQMzF2MmxqNDZzbDRQaG95Y2hrT243R3dGVkNTZWMxK2x5ZEwvWW0ycTBNQ21WbDRzYWo3YjRXOStwejJkaDFCSUNoUkFlaFBmR1NFdHZHUm4vM3ZTYmZ1VlplYzhGSnlFK2FQWXNXY2RISGZhUklpeW80aTMwRGxNUUVLUEZDM2wyOGFVOG9FbEl4UEdkZEN3cVFMMDhxclY1aEMyK3NvNFdTaEFZV0lTamx0T1F0STRYWnU1elZtL29HQnFJYXBqRjFTT0VBVWpxSHZkMXpZdDFNTm5GMmRDS2prWVZkNkhsVk1WSmRIUld2M1VqTzJrUkVUaXJSZXFhQ2tEbDV3UUR5KzVxQmErYXg4ZTlDcURHaEVWZkNPZlM4cW1seGVoTTN5R3pwVGJ5aVpFeXUraFFFSU45cERFeTlrSXRzOEpHU1RZM2RHSStKYWMrcmtoWVdCTDJlenExOWNjdDRYdFlIcEh3NnZkWjFjdDFraHA4UjE2R3FSb09EZXNwRnlsU1FFczkzZW4ydjcraUxkdVpLQ2lhNmorVUJ1YXN5dXZKc0xyWUcxWXlCZUNSNU11SjVPU0RuZFg3RUhkaTROeFFaekRjb2xvNURGamVVQjJjenNiVkZBSVZabGpjR0tFOWxFbzFYMndZZjh0ZlU1ZjBNeGRLQUxPZUdibWhtaEZvalZkVllFaEFEdE1GN1czS1hzL3ZCZkV1SVpWWFcxeHBMNjVheTRRY2h3aTR5d3BCblpUUzZ3N1I0UnIydktBN3BsYnpsdkN3THlFMUJlZTBzbGwrTVp4dTVhSGdiT3lrVFpXQlAvRjd2N3RmN1loMjV1Ty9vZTFnU2tDc2FTNnFXY3NQM3UwbkpaWmJ0R0l2WmVDOHZKZE9RWHZrMDZRNDh2enNVNmM0MUtKYTBJWXVaeUZXVnRCVGtjeVFkbVV4SGU5WEs4TVhMYkVQckw2eXY4ZjdmQTdLd29jTFZSQ2V1cE5IUHpWT0xncWpNWnVPelZ0bkJ5SlBMYzdwcExhZXl2bFZHcnBqSEpyNGhaem5uTUJzclRORlUwdUtNTS8xSFk4L204R0FycCtncllXSUxTRWNSS1prV2R5aWhBZnVnUFdGZ1UzeUtpZi80dnBhaXBVckg2ZTFuS1VCdWFBclUxbFA4UEQ2WGxud0NEbzRjYk5rV3NMR0gxelQ1WnVobHRwTHhsZ0traFk2dmdQSWRQekxDS2czZGJsQmRsUmR6dzMrNHFMNml6R3k2ckFOSVlENFRKSVVWck9FWksvMHNSQ1Bmd3ZCelZ0bER2eVZLWnJQNlp4eC9Cc3NBc2liUVVWSlBDNDA1aWNvMWNEUU9vTXhoNDh2V0ZlLy9vWWJoaW9kWUJoQndkUmY1S0NtQUozcFdiRWdXaFVhZWphKzl0ZGx6aFZrMFdnWVE4S3d1d2RTRlJmRkk4aDl0V3dDS0t5N2lodSs0dWNuWGFBWW8xZ0NrcXBtcnBJVHBsa1pqaFBzWXlWZFRZdlVGM1BCakMrc3JYRWFEWWdsQTFqcTcvTVdrV0dVbDcyb2lSdU1aeW1SR2FMdldIcnFISUs0ampRVEZFb0NBL1pqcUpHVS9Sc2VGMGdRZ0ZzNVFWdDNiOHVocUkybTJCQ0M4VEo3akFFb3NFZzhxNGk5Nmd3NmcrQncyK3ZNMVRmNVBLUnFrb0pNRkFIbVJCT21ZUXhXQ0FSbkZVTXhHUTlEb1hzS0Y3LzlzZlFXbmdOOVp1K1FmRVBKbEVzcEM2L09ZM00zS3BJazZZSHdDajBQTXU4emVmNmV1aVVZRzV4MlE1cG9OWlJ3cFZ4YVErZmdJMzVGdWpKMW1Ndkh2UUh5eVJDOG9lUWZrWERiQ3VrakpYa2dHZlRUVGsrVkVwRVNleFVidm5seFg0OUFEaXFubklRdm5WL2lXdGpuOEY3ZlozRTIxSGpmbjlETHZueHlLWlJMOFM1cDNsTGlsYndNaHRrS1ZFbHdQZ2hLa3BOSTZpbzg4M1NPOHBoVVVRM3pvU1EwMTNtcy9QM2hHYlpuWVZ1d1JaL3RjVW0xOU9VK0lJaGtVSmNKRGd4d0tRREZORTFpSWR2cm9TWWFJSnFqOWgwNHorNFozRXVHTE9zUDNzS0xNeU5DUHpMdk1hbVVsUVhEQXpkTVNIZHFZY00vKzJjSCtZMXBtMGczSVo4NnRjTjMrOWQ2dGpiWENITGNUOWpnOXNzL3hSL3BLVTRaM1MxL0piVVVTNFZNa1FiMHBFVEVvNUl6QWxZRG5aV1V3bENUS3JtN3F0TEJFM3hoMDM3Znp0c2VXN1l0ZnJXVW0zU3Jyam12a215NllGLytxalFIdW85eG1YaGhZakw0eVA0Y2hIS0RHOHVEVDF4S0V1eGxLY1NwU2N3Z2dTektFN29VbU1lZ3RGbEZ5YTVPdjZCbW83MUpkdGFKTFFWeXlxS3A0UmtQaUJnS1Nna2tnMURhVUFCeUhPUk5rUHB3ME9CdEFGNE92VW5FSkZFTTNwU1pFaVNtVWhzc3BwU1JIUFNYOGxDaGVvSnEvdWlUazU5ZElWNTQ5TS80VlVnc1l5R0VFQkUxOGI0WjZRdVlEdm93SEFKa0VscjQ0cGNiRU1IVFBWSGNXUmdpbEJGejVTVjUyY09NYmZiRXVOYVNxUmpBOXViK2t3VjBmNUcrZ1VGWHBjWS9Hc3hNSU1zenJCRkFxUHc4RmJETUxSMXFRZEhnK25wdlB4RmFxQVFQN2FnYmt6bS8ybk5sY0xVd2xRUDlyYmdoa3RsMlAzcGtOSG1zK2p5REtMa3o5VzlZcWtab0pWVDhRNDZveVN2Z3FwRlFxMVl6V0RNalVPdjV5bHcvMGl4N3BTS3V0YkJRbncyRlFZWlBob2MzUEVBUUw5WVJXQndYelhQRFlYTWx5ZS8vQ2JNdkwvRndUSUhObVZKV1ZlTVF2R0pLZVJTdW1sQXFRUm5zVmdBSkduL1ZaR3hUY1F6YllyUldrZUFWUkFybFRoVTF4eDh6NXJydDBjRXAxcVZpVzlJNzBOcVJBVGJ3QjkrUktBWlJQQXloZytLMHNLU2dsSGxKYWRKWDN1T0xqWGsyQU5GZnppNTF1VUZkR3VLTW9JWGlwVVgwSUNsUklsUzJHb2ZqTWs1cXhlamVRaXZISW5uSmFkSnpQUk9ZcUhhWUJrR3NvQnljdlViV3J4Nk1tV2NvQkY3Nk1SRzBEVU94Z0xrdk9VU2xoYXUram8zOVNiVUdNQnErSVVwd0ZWZzNJeGVkdnJJVjhWWXVtUUhDc3hTRUZXSHFtWlpjREtLNVdVQXZUVWxHOUZSdDZXMUJSTTcrMHRrNVJGbGcxSUhOYjQ4MEJqK3d4UkYwaEI5Ris2SG5VRXZSQ0FCU0NyY1NhOWdUUFNseUUxTENNSFlLSUtudFREY2dsQ3lJdU56NzFaNFQ5U05PbkJ4QllNT1VFVU9hUEpDU3pyem1uUFRCazhsSVNWMDBKaW9xMVZRTkMwL0xVcElveHNpRWdxaW5KSUFEVWxiTWVWQVBrd2F5bXVsQVRPOENPVEtIamtBVEszbFN6Z2VmSmFZWVk5RFJ0S1ljOVpkaTEySkgwUEtENmZMTlNDVXFyTlFab2MxT1NPU3JMN1pTOHVoZzNtbHNJQWpKUnIvc0t1c0VXQkNrQlNiRmliT0lnWkVVcEZOVVNjcnlMV1dnb0lBZ1FVbEZrd0w2R25laVpZajFiZ3A3V01ZbjluSklWcWdZRVloQ240WUFncFZnbHF5WmlIMnQxNEdqWXl5Rm9CRzF0SlNsQlFJQnBpcmFjYWtCc3JNNTArMWlNUkxXRjVHcU5SekxzRVFuMkNOV1dLWnRHeVJZZm93OHV6dzdQVFNwcHFnSFJZM2ZISlFnbnhiby9CRVh2RFhBMzFsalR1SnNDU0N3T0dPcFZMV05SaG5OQ0JsZjMzTEFSV1Q4NGJXN3JIUDBtRDBheHBFWkJVOVlyWTZKb2doeld6YlR4MUJaa2IzVzd2eGdvZ3RyQ3lOM1E0RlVCTThmcmdreU9FYVNpZDNHcEJxUzJqSC9WTkVBd0hrRlE5S290MkpKSlFDelNLT0R5SklwL1RnazVxZ0hwRDlORHBnQ0MxS0pzQnd4UVd6QUZuaXJxaXY2VmNFOUZuNUJNRFNqcHJob1FwMDE2Vy9jT0hvOHlkRVJRUWpBdnFrZEtZQjRHM0doS2IvU3ZoSU1LK21BK0MvYmFQZ1ZkMWUraE9FKytKeVhNc09vajVDSVRNZXVqQnhBWWpnZFhwSlp6RmlWY1U5RUhPUldYU2FKZHRKbGpRNTdhVmhRZEhLSms5VkFxWEFVQ2dXb0wzV0N0b01BNExFVzFBaUNvZ2dZa1N1NldtUDFLT0tCYVplMCs1TmdiQ3BPOXlXTlhNMW95aW9JTGpiSldRRkJGSUNDcVYyZjhnbWdRa1VHWjZuNlpkeDVSTXJ0cWtsL2UvbjVYYUloKzF6UUpRYW9SQ0NoazBDVWxTbGFmZ3o0SUNOaVE3ZTJkU3hUVithb0dCTTBUbEVvK2E2cVBiNENVWUQyd0ZXcUMwVTlKeU9RV1FsNm5DSDROZ0JERXRqMzI3UU1oc0NObXFhMjBsRUE2WFZOYUhuWWxKaGZ6bldCRTVuYUxOUEVQd2JsSEVSclFTUk1ndjNyQ3UvLzlIdWFvNllDZ1ljZkhFelRZRWdtK0FpemZwNGQ0TU5VclUvdWVqSHZlTlJXUXpnODZoMDZINktlVTNrUnpQNVIzZElFeHlGT1dMRTNkQ2hnaERNTVFyRVF4MFVQUHRpNnMxZy9MMUlZam5aMVF1NitzYVpJUW5McjlDTGUrdHdlKzVFYnpETW9JVE01ZkRaZWFJQThZd2ZmRG1Ed1daYU0yN3hMcHhHdTg4M21GSzAxMjA4ek9tKzZ0N3RoL2d2Mlg0UVVQbzZsSGRZV0hWM0R3cEZoMXdaZ0VQbk9TeDhZQlo0K0p6STY3ankzZHJZWU16WUFReEh1eHJoQjlXeUlDSlJWbXE0VmtUYVp5MVNWRFVYYThSODkyVThQQ2ovZEZkZ3hCdXYyUXhOMUhDT3ZWS0Z2dEVvSmtmT09lcXI5M2RFSUVhc2hMSmJJd0FiZE9IVnpaSW5qb2grcUtoMVJlOG9tclBEUjhHdmVJd096NVJiUmtzOXJiNjVBUWd1anA2b2p1M0crL2s0L0IrYVN1bVJTUW5TeHdnZ3NlRHAxUUlvR082UHRnMFBGYncvSUFDTjV5R0tSanY4amQxbnZpS0xnVzZwcHVObjc5anJMSDJ6dTQ5cHhJQ1FvLzVybXdvR1k4UlFDZTFmRHgvSUNCckxkaldsZGszN294WExsSkhSU3Azcm9CSWNURHdqLy9iZi9lUUI4bG1ocVhwRmVIa29LeENhWldSb01DcmswY0hySEVLeDk1TEl3N3VtUmEyaVhZZjBoODJLSHB5NUQxQXdKOHVmSGVnVmRlZTlmK1JFNEFRV0JRTDZEcXdqUDRVYUFNUWs0MVgrb0s4MWJ0QXJmdVp3ZFB2YVJGT295UmtKRTdiOWxadFBwb0o5T1JMQXMxdTZHVW9LTVB0YndFRkRNa1FVRmpEbzlQRDBOT05ma1dpQnczVkZVSEJQYkljd25YbXBTeDA5WU1JMzNYZTVGWWM1M3JTRXNsdjhMdWtHbFZrYlUyMmxPZ29KU2c2UVFqSHZvWEdQUVBjZzhJcXFwK21ZcHU0NTJYL2ZwUTZJRFc1ZUE0d3dEQnlUYS9FVCs0WUxxRGE2NFR6cU5RcldqSVFhbGVESzRBREgwY0pLTUh2aUl5YVR0eTZGM2g3U1R3cjdmeWp0dXY3eGgrVkRYOW93WVlZa015NTd6MEJ3MjNiWHZML2xjQ3QwMHUyb2o2d2pjL09PQUozVnhtZUhHRkxPeThkM2piSDc5MStzemJqRml1b1JLU0lxaGIzTk5aK2Vyc1NiSHpxcXJGS2tPZTFKMW9wYmlsVG9JSmdVRFFCYys2aXZCMXcwa3ZDN2xsNHA3QXFlMXc3M2FlMjNwenBQeHIzYWYzUkN3S0NQQ25heUJzZHdZMk53YjVoY1ZsVXFWcG9DUVByT0hDdUFQNUQ5c0w2M3J4Wnd4QVNyN215U1JROERWTUhRTDcycE1KOS9JWGpwMENkOEtZWm9LRXBBamIrZS9JRUdmemJhNHZGUmFXbEVrVmhvT0NqTVlYMXh5R0t6UE5EcjlIMWNWQk9XbjhORWdNOURFeUprbEtCdngxVUdSZlh4LzNmUEhodzMyWU5UT3NtUVlJVXJoOVQzUXduQ2g1b2R3alhsQmRMWlliNW5taFpPQTdWaEFNVkJTakxTSFlGUTZLSkp5USsrS2grSWFIcjdJM1FvWGhiV3hnTTk0V2JHK3NqM20vK0ljalBZck95ZFdnWlNvZ1NNanVBOE1ET3c2VWI1NVN3N2ZXVllqTnlSaEJWZjV6MUhLUUs1aW5RakNHeGdBajNSM3VRVU00Z0hZRmEzM1JybURBcUZWYWtzY3hnT283QXJmK2xranhWWDg3ZHRwUXlVaVRiVG9nZUtPdTNzR0J4emJQZUdwTzZ3QmI2cFBhSEM2b0hOTnllSVJncE5YVVJHQ2tWNGYxV1RBRzM0K0NqeWlJRUs4a1FGcXdxYkV0cUtMNkNGcmNJZGh1K2ZMeGM3NTdxcWRkZGRKUXFaVGtCSkFVTWFmRVA3L0V2MUpYNGQ1ZDRwSG0rZ05TNEdQdlpKeUlhZ1FEYS84T2phT21KaHFMMGdLSFhDZ3RhRnN3UFkvZ1pBTUdtY01DR0IwU2UzUkxvbWpsalIzaGh3bmhpS25SVlE0QlNURUFnc2NEeDd0S24zSFo1WVpnUUpwc2Q4UDZKcEtXdFBzS0JwbzRCaGZhRGkzUkU3SVI1c0lYMTdqaDFZR296Z1R3ME5CTkhnME1UajhpRmNSYmd2MlIrMlArS3g4NTNBdDVBUE5iemdIQkplMC9Oank0NGNWSG5xd3FmL2x0ME0zVHl3SlNFUFg4UjJ3TEFvR2NRYU9OUUNBZ0kwelZ4UlowaGVHbStKNFVmS2NqRFM4ZHdOY0hpbkNmSkJEd1Z4ejAyVjdSdGd0U0lTdFhId2pmZTdnL3JMaElRUmR0cVQyVDc5WmE5UGl0SDF3K3V6bHhJN3loYmdwakI0NmhHNHUyQWtGQVB3Yi9yMFVxc2kwTlY0OWJFdTRsd0tIV2grMFUwWEdTZWZlRXpOeTZzcmZsZWFKNzkwZGUrcHh0T2lNK3R3QWdxV1VVdVNaNUhyMjU2K0xHS3Y3YVdsbG9LK1pCanlFN1VDck0wTm9JOEVqZXEzdUlsazlHNksySFBtUWZXUFowM1JhaWQ2OGhVYmNXZ0N3RHlQK0l2NVJadTJSYjIwWFRJb3NEVHVsTFFaZlk2c2Z2aklaQ3lmKytBMWd0U0drN2xBWkJJZ2tvR0pkN0l2VGV2aWoxeEhNSGlsNzU2Yk4zYkljcUFUME91UmIrZjJ5TUJRSEpwTEhWZWN1bDNXZTExY2JtMW5qNUJWQmFNOTl0azRJQnAwelIrSGcyZ29RTmYyU3lNbTEvOEROZ3ZzaVRSRitVRk1OeDZoUzhuZWVONC8zTWpqZFAySGYrNk9tS1hRU3hOK2RxYVNMay9nT0IxcVc2M2JvdzVnQUFBQUJKUlU1RXJrSmdnZz09Jw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNldEFwaVVybChhcmdzKSB7DQogICAgICAgICAgICB0aGlzLmFwaVVybCA9IGFyZ3MuVVJMOw0KICAgICAgICB9DQoNCiAgICAgICAgc2V0QXBpS2V5KGFyZ3MpIHsNCiAgICAgICAgICAgIHRoaXMuYXBpS2V5ID0gYXJncy5BUElfS0VZOw0KICAgICAgICAgICAgY29uc29sZS5sb2coJ0FQSSBLZXkgc2V0IHRvOicsIHRoaXMuYXBpS2V5KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZldGNoRGF0YShhcmdzKSB7DQogICAgICAgICAgICBjb25zdCBwYXRoID0gYXJncy5QQVRIOw0KICAgICAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5hcGlVcmx9LyR7cGF0aH0uanNvbmA7DQoNCiAgICAgICAgICAgIHJldHVybiBmZXRjaCh1cmwpDQogICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05ldHdvcmsgcmVzcG9uc2Ugd2FzIG5vdCBvazogJyArIHJlc3BvbnNlLnN0YXR1c1RleHQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShkYXRhKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZGF0YSlbMF07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBkYXRhOicsIGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFcnJvcic7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICB3cml0ZURhdGEoYXJncykgew0KICAgICAgICAgICAgY29uc3QgcGF0aCA9IGFyZ3MuUEFUSDsNCiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXJncy5WQUxVRTsNCiAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYXBpVXJsfS8ke3BhdGh9Lmpzb25gOw0KDQogICAgICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7DQogICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywNCiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh2YWx1ZSksDQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmV0d29yayByZXNwb25zZSB3YXMgbm90IG9rOiAnICsgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAnU3VjY2Vzcyc7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB3cml0aW5nIGRhdGE6JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgIHJldHVybiAnRXJyb3InOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBkZWxldGVEYXRhKGFyZ3MpIHsNCiAgICAgICAgICAgIGNvbnN0IHBhdGggPSBhcmdzLlBBVEg7DQogICAgICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmFwaVVybH0vJHtwYXRofS5qc29uYDsNCg0KICAgICAgICAgICAgcmV0dXJuIGZldGNoKHVybCwgew0KICAgICAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05ldHdvcmsgcmVzcG9uc2Ugd2FzIG5vdCBvazogJyArIHJlc3BvbnNlLnN0YXR1c1RleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gJ1N1Y2Nlc3MnOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgZGF0YTonLCBlcnJvcik7DQogICAgICAgICAgICAgICAgcmV0dXJuICdFcnJvcic7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJlZ2lzdGVyVXNlcihhcmdzKSB7DQogICAgICAgICAgICBjb25zdCBlbWFpbCA9IGFyZ3MuRU1BSUw7DQogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IGFyZ3MuUEFTU1dPUkQ7DQogICAgICAgICAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vdjEvYWNjb3VudHM6c2lnblVwP2tleT0ke3RoaXMuYXBpS2V5fWA7DQoNCiAgICAgICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHsNCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZQ0KICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpDQogICAgICAgICAgICAudGhlbihkYXRhID0+IEpTT04uc3RyaW5naWZ5KGRhdGEpKQ0KICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWdpc3RlcmluZyB1c2VyOicsIGVycm9yKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gJ0Vycm9yJzsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgbG9naW5Vc2VyKGFyZ3MpIHsNCiAgICAgICAgICAgIGNvbnN0IGVtYWlsID0gYXJncy5FTUFJTDsNCiAgICAgICAgICAgIGNvbnN0IHBhc3N3b3JkID0gYXJncy5QQVNTV09SRDsNCiAgICAgICAgICAgIGNvbnN0IHVybCA9IGBodHRwczovL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbS92MS9hY2NvdW50czpzaWduSW5XaXRoUGFzc3dvcmQ/a2V5PSR7dGhpcy5hcGlLZXl9YDsNCg0KICAgICAgICAgICAgcmV0dXJuIGZldGNoKHVybCwgew0KICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsLA0KICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsDQogICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlDQogICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkNCiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gew0KICAgICAgICAgICAgICAgIGlmIChkYXRhLmlkVG9rZW4pIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICd0cnVlJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2ZhbHNlJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2dnaW5nIGluIHVzZXI6JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgIHJldHVybiAnZmFsc2UnOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsKGFyZ3MpIHsNCiAgICAgICAgICAgIGNvbnN0IGVtYWlsID0gYXJncy5FTUFJTDsNCiAgICAgICAgICAgIGNvbnN0IHVybCA9IGBodHRwczovL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbS92MS9hY2NvdW50czpzZW5kT29iQ29kZT9rZXk9JHt0aGlzLmFwaUtleX1gOw0KDQogICAgICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7DQogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsDQogICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0VHlwZTogJ1BBU1NXT1JEX1JFU0VUJywNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsDQogICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkNCiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4gSlNPTi5zdHJpbmdpZnkoZGF0YSkpDQogICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgcGFzc3dvcmQgcmVzZXQgZW1haWw6JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgIHJldHVybiAnRXJyb3InOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBnZXRFbWFpbFVJRChhcmdzKSB7DQogICAgICAgICAgICBjb25zdCBlbWFpbCA9IGFyZ3MuRU1BSUw7DQogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IGFyZ3MuUEFTU1dPUkQ7DQogICAgICAgICAgICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vdjEvYWNjb3VudHM6c2lnbkluV2l0aFBhc3N3b3JkP2tleT0ke3RoaXMuYXBpS2V5fWA7DQoNCiAgICAgICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHsNCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywNCiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZQ0KICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpDQogICAgICAgICAgICAudGhlbihkYXRhID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sb2NhbElkKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLmxvY2FsSWQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6IE5vIHVzZXIgZm91bmQnKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdFcnJvcjogTm8gdXNlciBmb3VuZCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgVUlEOicsIGVycm9yKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gJ0Vycm9yJzsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgU2NyYXRjaC5leHRlbnNpb25zLnJlZ2lzdGVyKG5ldyBUdXJib2Jhc2VFeHRlbnNpb24oKSk7DQp9KShTY3JhdGNoKTsNCg=="]) {
        vm.extensionManager.loadExtensionURL(extension);
      }

    } catch (e) {
      handleError(e);
    }
  </script>
  
  
    <script>
      const getProjectData = (function() {
        const storage = scaffolding.storage;
        storage.onprogress = (total, loaded) => {
          setProgress(interpolate(0.2, 0.98, loaded / total));
        };
        
        storage.addWebStore(
          [
            storage.AssetType.ImageVector,
            storage.AssetType.ImageBitmap,
            storage.AssetType.Sound,
            storage.AssetType.Font
          ].filter(i => i),
          (asset) => new URL('./assets/' + asset.assetId + '.' + asset.dataFormat, location).href
        );
        return () => new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.onload = () => {
          resolve(xhr.response);
        };
        xhr.onerror = () => {
          if (location.protocol === 'file:') {
            reject(new Error('Zip environment must be used on a website, not on a local file. To fix this error, use the "Plain HTML" environment instead.'));
          } else {
            reject(new Error('Request to load project data failed.'));
          }
        };
        xhr.onprogress = (e) => {
          if (e.lengthComputable) {
            setProgress(interpolate(0.1, 0.2, e.loaded / e.total));
          }
        };
        xhr.responseType = 'arraybuffer';
        xhr.open('GET', "./assets/project.json");
        xhr.send();
      });
      })();
    </script>
  <script>
    const run = async () => {
      const projectData = await getProjectData();
      await scaffolding.loadProject(projectData);
      setProgress(1);
      loadingScreen.hidden = true;
      if (true) {
        scaffolding.start();
      } else {
        launchScreen.hidden = false;
        launchScreen.addEventListener('click', () => {
          launchScreen.hidden = true;
          scaffolding.start();
        });
        launchScreen.focus();
      }
    };
    run().catch(handleError);
  </script>

  <!-- Firebase SDK Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <!-- Firebase Configuration -->
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD6KM7s1q8WipzjTHbqqA5MCFSMNo9ApVg",
      authDomain: "fir-place-3b4ad.firebaseapp.com",
      databaseURL: "https://fir-place-3b4ad-default-rtdb.firebaseio.com",
      projectId: "fir-place-3b4ad",
      storageBucket: "fir-place-3b4ad.firebasestorage.app",
      messagingSenderId: "209625972319",
      appId: "1:209625972319:web:9e26c359fb14f1c51ea5ea",
      measurementId: "G-8V7KFR53TW"
    };

    // Initialize Firebase
    if (typeof firebase !== 'undefined') {
      try {
        firebase.initializeApp(firebaseConfig);
        console.log('âœ“ Firebase initialized successfully');
      } catch (error) {
        console.error('Firebase initialization error:', error);
      }
    }
  </script>

  <!-- Firebase Cloud Provider Integration -->
  <script src="firebase-cloud-provider.js"></script>
  <script>
    // Initialize Firebase Cloud System after project loads
    (async function() {
      // Wait for VM to be ready
      const waitForVM = () => {
        return new Promise((resolve) => {
          const check = () => {
            if (window.vm && window.vm.runtime) {
              // Also wait for the project to be fully loaded
              const stage = window.vm.runtime.getTargetForStage();
              if (stage && Object.keys(stage.variables).length > 0) {
                resolve();
              } else {
                setTimeout(check, 100);
              }
            } else {
              setTimeout(check, 100);
            }
          };
          check();
        });
      };

      try {
        console.log('[Firebase] Waiting for project to load...');
        await waitForVM();
        console.log('[Firebase] Project loaded, initializing cloud system...');
        
        // Now initialize the Firebase cloud system
        const cloudSystem = new FirebaseCloudSystem(
          firebaseConfig,
          's_place',
          {
            debug: true,
            maxRetries: 3,
            rateLimit: 10,
            pollInterval: 500
          }
        );
        
        await cloudSystem.initialize();
        window.firebaseCloudSystem = cloudSystem;
        
        console.log('[Firebase] Cloud system ready!');
        console.log('[Firebase] Stats:', cloudSystem.getStats());
      } catch (error) {
        console.error('[Firebase] Failed to initialize cloud system:', error);
      }
    })();
  </script>

</body>
</html>